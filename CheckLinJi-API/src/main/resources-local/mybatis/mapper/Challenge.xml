<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.upside.api.mapper.ChallengeMapper">
	
	<!--첼린지 인증글 리스트 -->
	<select id="viewChallengeList" parameterType="PageDto" resultType="java.util.Map" >
		SELECT   CS.CHALLENGE_SUBMISSION_ID AS SUBMISSION_ID
				,CS.SUBMISSION_IMAGE_ROUTE AS SUBMISSION_IMAGE
				,CS.SUBMISSION_TIME	
				,(SELECT COUNT(*)  FROM LIKES 
					JOIN CHALLENGE_SUBMISSION CS 
					ON LIKES.CHALLENGE_SUBMISSION_ID = CS.CHALLENGE_SUBMISSION_ID 
					WHERE LIKES.CHALLENGE_SUBMISSION_ID = SUBMISSION_ID) AS LIKE_COUNT
				,(SELECT COUNT(*) FROM COMMENT CM  
				JOIN CHALLENGE_SUBMISSION CS 
				ON CM.CHALLENGE_SUBMISSION_ID = CS.CHALLENGE_SUBMISSION_ID 
				WHERE CM.CHALLENGE_SUBMISSION_ID = SUBMISSION_ID) AS COMMENT_COUNT
				 FROM CHALLENGE_SUBMISSION CS 				 
			ORDER BY SUBMISSION_TIME DESC 
			limit #{startPage} , #{endPage} ;			 
	</select>	
	
	
	<!--첼린지 인증글 상세페이지-->
	<select id="detail" parameterType="ChallengeSubmissionDto" resultType="java.util.Map" >
			SELECT   CHALLENGE_SUBMISSION_ID 
					,SUBMISSION_TITLE
					,SUBMISSION_TEXT 
					,SUBMISSION_IMAGE_ROUTE 
					,SUBMISSION_TIME 
					,NICK_NAME 
					FROM CHALLENGE_SUBMISSION CS 
					WHERE CHALLENGE_SUBMISSION_ID = #{challengeSubmissionId} ; 
	</select>	
	
	<!--첼린지 인증글 상세페이지 좋아요 개수 -->
	<select id="likesCount" parameterType="ChallengeSubmissionDto" resultType="int" >
			SELECT COUNT(*)  FROM CHALLENGE_SUBMISSION CS
				JOIN LIKES 
				ON CS.CHALLENGE_SUBMISSION_ID = LIKES.CHALLENGE_SUBMISSION_ID 			
			WHERE CS.CHALLENGE_SUBMISSION_ID  = #{challengeSubmissionId} ;
	</select>	
	
	<!--첼린지 인증글 상세페이지 댓글 -->
	<select id="commentList" parameterType="ChallengeSubmissionDto" resultType="java.util.Map" >
			SELECT   CM.COMMENT_SEQ 
					,CM.CONTENT
					,CM.NICK_NAME
					,CM.UPDATE_DATE			
					FROM CHALLENGE_SUBMISSION CS
							JOIN COMMENT CM  
							ON CS.CHALLENGE_SUBMISSION_ID = CM.CHALLENGE_SUBMISSION_ID 			
						WHERE CS.CHALLENGE_SUBMISSION_ID  = #{challengeSubmissionId}  
					ORDER BY COMMENT_SEQ ;
	</select>	
	 
</mapper>