## 랭킹 집계 작업 

	SELECT
  		   MI.NICK_NAME
  		  ,MI.EMAIL 
  		  ,MI.PROFILE 
  		  ,MI.GRADE   		  
  		  ,IF(TIMESTAMPDIFF(DAY, DATE(MI.JOIN_DATE), NOW()) = 0, 1, TIMESTAMPDIFF(DAY, DATE(MI.JOIN_DATE), NOW()) + 1) AS joinDate  		  
      	  ,IF(DATEDIFF(CURDATE(), MAX(SUBMISSION_DATE)) = 0, 30, 0) as daily_success // 하루 30점 
		  ,IFNULL(SUM(DATEDIFF(CURDATE(), SUBMISSION_DATE) BETWEEN 1 AND 7), 0) * 4.3 as weekly_success // 하루당 4.3점 7일 시 30점 
	      ,IFNULL(SUM(DATEDIFF(CURDATE(), SUBMISSION_DATE) BETWEEN 1 AND 31), 0) * 1 as monthly_success // 하루당 1점 31일시 31점
	      ,IF(DATEDIFF(CURDATE(), MAX(SUBMISSION_DATE)) = 0, 30, 0) 	// 하루 + 주 + 월 합산      
	       + IFNULL(SUM(DATEDIFF(CURDATE(), SUBMISSION_DATE) BETWEEN 1 AND 7), 0) * 4.3 
     	   + IFNULL(SUM(DATEDIFF(CURDATE(), SUBMISSION_DATE) BETWEEN 1 AND 31), 0) * 1   	    	    
	       as point 
          ,ROW_NUMBER() OVER (ORDER BY 
        IF(DATEDIFF(CURDATE(), MAX(SUBMISSION_DATE)) = 0, 30, 0) 
        + IFNULL(SUM(DATEDIFF(CURDATE(), SUBMISSION_DATE) BETWEEN 1 AND 7), 0) * 4.3 
        + IFNULL(SUM(DATEDIFF(CURDATE(), SUBMISSION_DATE) BETWEEN 1 AND 31), 0) * 1        
        DESC
    ) as rank
	FROM
    	CHALLENGE_SUBMISSION CS
    JOIN USER_CHALLENGE UC ON CS.USER_CHALLENGE_ID = UC.USER_CHALLENGE_ID
    JOIN MEMBER_INFO MI ON UC.EMAIL = MI.EMAIL 		
	GROUP BY
    	CS.USER_CHALLENGE_ID
    order by RANK ; 